<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>SFacts - Enhanced Analytic Hierarchy Process (AHP) Tool</title>
    <meta name="description" content="Advanced AHP tool with sensitivity analysis, form validation, and enhanced features for decision making">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="css/chartist.min.css">
    <link rel="stylesheet" href="css/styles.css">
    
    <script>
        var global = window;
        // Remove query params to prevent interference with auto-save/auto-load feature
        if (window.location.search) {
            window.location = window.location.pathname;
        }
    </script>
    
    <!-- Core AHP System -->
    <script defer src="js/index.js"></script>
    
    <!-- Enhanced SFacts System (ES6 Modules) -->
    <script type="module">
        import('./js/modules/main.js').then(() => {
            console.log('ðŸš€ SFacts Enhanced 2.0 loaded successfully');
        }).catch(error => {
            console.warn('Enhanced modules not available:', error);
        });
    </script>
    
    <!-- Original System (for compatibility) -->
    <script defer src="js/rolledup.js"></script>
    
    <!-- Enhanced Integration Layer -->
    <script defer src="js/enhanced-integration.js"></script>
    
    <style>
        /* Enhanced System Styles */
        .enhanced-features {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 12px;
            display: inline-block;
            margin-left: 10px;
            vertical-align: middle;
        }
        
        .system-status {
            font-size: 12px;
            color: #666;
            margin-top: 5px;
        }
        
        .system-status.active {
            color: #28a745;
        }
        
        /* Fix for Calculate button */
        #calcbtn {
            cursor: pointer;
            position: relative;
        }
        
        /* Loading animation */
        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 10px;
            vertical-align: middle;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Results container */
        #results {
            transition: all 0.3s ease;
        }
        
        .results-hidden {
            opacity: 0.5;
        }
        
        /* Notification styles */
        .calculation-notice {
            background: #e7f3ff;
            border: 1px solid #b3d7ff;
            border-radius: 5px;
            padding: 15px;
            margin: 15px 0;
            display: none;
        }
        
        .calculation-notice.success {
            background: #d4edda;
            border-color: #c3e6cb;
            color: #155724;
        }
        
        .calculation-notice.error {
            background: #f8d7da;
            border-color: #f5c6cb;
            color: #721c24;
        }
    </style>
</head>
<body>
    <div class="header-container">
        <header class="wrapper">
            <h1>
                SFacts - Analytic Hierarchy Process (AHP) Tool
                <span class="enhanced-features">Enhanced v2.0</span>
            </h1>
            <div class="system-status" id="system-status">
                Loading enhanced features...
            </div>
        </header>
    </div>

    <div class="main wrapper">
        <aside>
            <h3>About AHP</h3>
            <p>The Analytic Hierarchy Process (AHP) is a structured technique for organizing and analyzing complex decisions.</p>
            <p><a href="https://en.wikipedia.org/wiki/Analytic_hierarchy_process" target="_blank">Learn more on Wikipedia</a></p>
            
            <h3>Data Management</h3>
            <p>
                <button id="datamgmt_reset">Reset</button>
                <button id="datamgmt_export">Export</button>
                <button id="datamgmt_import">Import</button>
            </p>
            <textarea id="datamgmt" placeholder="Data import/export area..."></textarea>
            
            <!-- Calculation Status -->
            <div class="calculation-notice" id="calc-status">
                <strong>Calculation Status</strong>
                <div id="calc-status-text">Ready for calculation</div>
            </div>
            
            <!-- Enhanced Control Panel will be inserted here by enhanced-integration.js -->
        </aside>

        <form id="ahpdata" name="ahpdata">
            <!-- Goal Section -->
            <section>
                <h1>Decision Goal</h1>
                <textarea id="goal" placeholder="Describe your decision goal..."></textarea>
            </section>

            <!-- Criteria Section -->
            <section id="criteria_inputs">
                <h1>Evaluation Criteria</h1>
                <p>Enter your criteria below (up to 8):</p>
                <div class="input-grid">
                    <input type="text" id="criteria0" name="criteria0" placeholder="Criterion 1" />
                    <input type="text" id="criteria1" name="criteria1" placeholder="Criterion 2" />
                    <input type="text" id="criteria2" name="criteria2" placeholder="Criterion 3" />
                    <input type="text" id="criteria3" name="criteria3" placeholder="Criterion 4" />
                    <input type="text" id="criteria4" name="criteria4" placeholder="Criterion 5" />
                    <input type="text" id="criteria5" name="criteria5" placeholder="Criterion 6" />
                    <input type="text" id="criteria6" name="criteria6" placeholder="Criterion 7" />
                    <input type="text" id="criteria7" name="criteria7" placeholder="Criterion 8" />
                </div>
            </section>

            <!-- Alternatives Section -->
            <section id="items_inputs">
                <h1>Decision Alternatives</h1>
                <p>Enter your alternatives below (up to 8):</p>
                <div class="input-grid">
                    <input type="text" id="item0" name="item0" placeholder="Alternative 1" />
                    <input type="text" id="item1" name="item1" placeholder="Alternative 2" />
                    <input type="text" id="item2" name="item2" placeholder="Alternative 3" />
                    <input type="text" id="item3" name="item3" placeholder="Alternative 4" />
                    <input type="text" id="item4" name="item4" placeholder="Alternative 5" />
                    <input type="text" id="item5" name="item5" placeholder="Alternative 6" />
                    <input type="text" id="item6" name="item6" placeholder="Alternative 7" />
                    <input type="text" id="item7" name="item7" placeholder="Alternative 8" />
                </div>
            </section>

            <!-- Criteria Pairwise Comparisons -->
            <section id="pairwise_criteria" class="pairwise_criteria pairwisetable">
                <h1>Criteria Pairwise Comparisons</h1>
                <p>Compare each criterion against others with respect to your goal.</p>
                <aside id="pairwise_criteria_sentence"></aside>
                <table>
                    <thead>
                        <tr>
                            <th></th>
                            <th class="crit0 criteria0" scope="col"></th>
                            <th class="crit1 criteria1" scope="col"></th>
                            <th class="crit2 criteria2" scope="col"></th>
                            <th class="crit3 criteria3" scope="col"></th>
                            <th class="crit4 criteria4" scope="col"></th>
                            <th class="crit5 criteria5" scope="col"></th>
                            <th class="crit6 criteria6" scope="col"></th>
                            <th class="crit7 criteria7" scope="col"></th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Table rows remain the same -->
                        <tr class="crit0">
                            <th class="criteria0" scope="row"></th>
                            <td class="crit0"><input type="text" id="criteria0v0" name="criteria0v0" value="1" readonly /></td>
                            <td class="crit1"><input type="text" id="criteria0v1" name="criteria0v1" /></td>
                            <td class="crit2"><input type="text" id="criteria0v2" name="criteria0v2" /></td>
                            <td class="crit3"><input type="text" id="criteria0v3" name="criteria0v3" /></td>
                            <td class="crit4"><input type="text" id="criteria0v4" name="criteria0v4" /></td>
                            <td class="crit5"><input type="text" id="criteria0v5" name="criteria0v5" /></td>
                            <td class="crit6"><input type="text" id="criteria0v6" name="criteria0v6" /></td>
                            <td class="crit7"><input type="text" id="criteria0v7" name="criteria0v7" /></td>
                        </tr>
                        <!-- Other rows remain the same -->
                    </tbody>
                </table>
            </section>

            <!-- Alternatives Pairwise Comparisons -->
            <section id="pairwise_items" class="pairwise_items pairwisetable">
                <h1>Alternatives Pairwise Comparisons</h1>
                <p>Compare each alternative against others with respect to each criterion.</p>
                
                <!-- Criterion 0 Comparisons -->
                <section id="c0_items" class="c0_items">
                    <h2 class="criteria0"></h2>
                    <aside id="criteria0_sentence"></aside>
                    <table>
                        <!-- Table content remains the same -->
                    </table>
                </section>
                
                <!-- Additional criteria sections remain -->
            </section>

            <!-- Calculation Buttons -->
            <section class="calculation-buttons">
                <button type="button" id="calcbtn" class="btn-primary">
                    <span id="calcbtn-text">Calculate Results</span>
                </button>
                <!-- Enhanced Calculate button will be added here automatically -->
            </section>
        </form>

        <!-- Results Section -->
        <section id="results" class="results">
            <h1>Analysis Results</h1>
            
            <!-- Results Status -->
            <div class="calculation-notice" id="results-status" style="display: none;">
                <strong>Results Status</strong>
                <div id="results-status-text">Waiting for calculation...</div>
            </div>
            
            <!-- Basic Results -->
            <div class="basic-results">
                <h2>Criteria Weights</h2>
                <div class="ct-chart ct-octave" id="criteria"></div>
                
                <h2>Alternative Scores</h2>
                <div class="ct-chart ct-double-octave" id="rankings"></div>
            </div>
            
            <!-- Enhanced Results Section will be inserted here by enhanced-integration.js -->
        </section>
    </div>

    <div class="footer-container">
        <footer class="wrapper">
            <h3>Open Source Project</h3>
            <p>
                This tool is based on the original <a href="https://github.com/ComcastSamples/ahp-tool">AHP Tool by Comcast</a>.
                Enhanced with SFacts 2.0 featuring sensitivity analysis, form validation, and advanced export options.
            </p>
            <p style="font-size: 12px; color: #666; margin-top: 10px;">
                SFacts Enhanced v2.0 | Built with modern JavaScript (ES6 Modules)
            </p>
        </footer>
    </div>

    <script>
        // Store original functions for backup
        let originalRunCalculation = null;
        let originalUpdateCharts = null;
        
        // Update system status when enhanced features load
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM loaded, initializing enhanced system...');
            
            const statusElement = document.getElementById('system-status');
            const calcStatus = document.getElementById('calc-status');
            const resultsStatus = document.getElementById('results-status');
            
            // Initialize form data
            initializeFormData();
            
            // Set up Calculate button with enhanced functionality
            setupCalculateButton();
            
            // Monitor for system initialization
            monitorSystemInitialization();
            
            // Add CSS for input grid
            addCustomStyles();
            
            console.log('Enhanced system initialization complete');
        });
        
        function initializeFormData() {
            // Ensure form doesn't submit and clear data
            const form = document.getElementById('ahpdata');
            if (form) {
                form.addEventListener('submit', function(e) {
                    e.preventDefault();
                    return false;
                });
                
                // Store initial form data
                storeFormData('initial');
            }
            
            // Set up input tracking
            setupInputTracking();
        }
        
        function setupInputTracking() {
            // Track changes to important inputs
            const importantInputs = [
                'goal', 'item0', 'item1', 'item2', 'item3', 'item4', 'item5', 'item6', 'item7',
                'criteria0', 'criteria1', 'criteria2', 'criteria3', 'criteria4', 'criteria5', 'criteria6', 'criteria7'
            ];
            
            importantInputs.forEach(id => {
                const input = document.getElementById(id);
                if (input) {
                    input.addEventListener('input', function() {
                        storeFormData('autosave');
                    });
                }
            });
        }
        
        function storeFormData(source) {
            try {
                const formData = {
                    timestamp: new Date().toISOString(),
                    source: source,
                    data: {
                        goal: document.getElementById('goal')?.value || '',
                        items: [],
                        criteria: []
                    }
                };
                
                // Collect items
                for (let i = 0; i < 8; i++) {
                    const input = document.getElementById('item' + i);
                    if (input) formData.data.items.push(input.value || '');
                }
                
                // Collect criteria
                for (let i = 0; i < 8; i++) {
                    const input = document.getElementById('criteria' + i);
                    if (input) formData.data.criteria.push(input.value || '');
                }
                
                // Store in session storage
                sessionStorage.setItem('ahp_form_data', JSON.stringify(formData));
                
                if (source === 'autosave') {
                    console.log('Form data autosaved');
                }
                
            } catch (error) {
                console.warn('Could not store form data:', error);
            }
        }
        
        function restoreFormData() {
            try {
                const saved = sessionStorage.getItem('ahp_form_data');
                if (saved) {
                    const formData = JSON.parse(saved);
                    
                    // Restore goal
                    const goalInput = document.getElementById('goal');
                    if (goalInput && formData.data.goal) {
                        goalInput.value = formData.data.goal;
                    }
                    
                    // Restore items
                    formData.data.items.forEach((value, index) => {
                        const input = document.getElementById('item' + index);
                        if (input && value !== undefined) {
                            input.value = value;
                        }
                    });
                    
                    // Restore criteria
                    formData.data.criteria.forEach((value, index) => {
                        const input = document.getElementById('criteria' + index);
                        if (input && value !== undefined) {
                            input.value = value;
                        }
                    });
                    
                    console.log('Form data restored from', formData.source);
                    return true;
                }
            } catch (error) {
                console.warn('Could not restore form data:', error);
            }
            return false;
        }
        
        function setupCalculateButton() {
            const calcBtn = document.getElementById('calcbtn');
            const calcBtnText = document.getElementById('calcbtn-text');
            const calcStatus = document.getElementById('calc-status');
            const calcStatusText = document.getElementById('calc-status-text');
            const resultsStatus = document.getElementById('results-status');
            const resultsStatusText = document.getElementById('results-status-text');
            
            if (!calcBtn) return;
            
            // Store original button text
            const originalButtonText = calcBtnText.textContent;
            
            calcBtn.addEventListener('click', async function(e) {
                e.preventDefault();
                
                console.log('Calculate button clicked - starting enhanced calculation');
                
                // Save current form data
                storeFormData('pre_calculation');
                
                // Show loading state
                calcBtn.disabled = true;
                calcBtnText.innerHTML = '<span class="loading-spinner"></span> Calculating...';
                calcStatus.style.display = 'block';
                calcStatus.className = 'calculation-notice';
                calcStatusText.textContent = 'Processing your data...';
                
                // Show results status
                resultsStatus.style.display = 'block';
                resultsStatus.className = 'calculation-notice';
                resultsStatusText.textContent = 'Calculating results...';
                
                try {
                    // Collect form data
                    const formData = collectFormDataForCalculation();
                    
                    if (!formData.valid) {
                        throw new Error(formData.message || 'Invalid form data');
                    }
                    
                    console.log('Form data collected:', {
                        items: formData.items.length,
                        criteria: formData.criteria.length
                    });
                    
                    // Method 1: Try enhanced calculation first
                    let results = null;
                    
                    if (window.SFactsApp && typeof window.calculateFromForm === 'function') {
                        console.log('Using enhanced calculation method');
                        results = await window.calculateFromForm();
                        
                        if (results && results.success) {
                            displayEnhancedResults(results);
                            showCalculationSuccess('Enhanced calculation complete!');
                        } else {
                            throw new Error(results?.error || 'Enhanced calculation failed');
                        }
                    }
                    // Method 2: Try original calculation
                    else if (window.runCalculation) {
                        console.log('Using original calculation method');
                        results = executeOriginalCalculation(formData);
                        
                        if (results) {
                            showCalculationSuccess('Calculation complete!');
                            ensureResultsDisplay();
                        } else {
                            throw new Error('Original calculation returned no results');
                        }
                    }
                    // Method 3: Manual calculation
                    else {
                        console.log('Using manual calculation method');
                        results = performManualCalculation(formData);
                        
                        if (results) {
                            showCalculationSuccess('Manual calculation complete!');
                            displayManualResults(results);
                        } else {
                            throw new Error('Manual calculation failed');
                        }
                    }
                    
                } catch (error) {
                    console.error('Calculation error:', error);
                    
                    // Show error
                    calcStatus.className = 'calculation-notice error';
                    calcStatusText.textContent = 'Error: ' + error.message;
                    
                    resultsStatus.className = 'calculation-notice error';
                    resultsStatusText.textContent = 'Calculation failed. Please check your inputs.';
                    
                    // Restore form data
                    restoreFormData();
                    
                } finally {
                    // Restore button state
                    calcBtn.disabled = false;
                    calcBtnText.textContent = originalButtonText;
                    
                    // Auto-scroll to results
                    setTimeout(() => {
                        const resultsSection = document.getElementById('results');
                        if (resultsSection) {
                            resultsSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
                        }
                    }, 500);
                }
                
                return false;
            });
        }
        
        function collectFormDataForCalculation() {
            const items = [];
            const criteria = [];
            
            // Collect items
            for (let i = 0; i < 8; i++) {
                const input = document.getElementById('item' + i);
                if (input && input.value.trim()) {
                    items.push(input.value.trim());
                }
            }
            
            // Collect criteria
            for (let i = 0; i < 8; i++) {
                const input = document.getElementById('criteria' + i);
                if (input && input.value.trim()) {
                    criteria.push(input.value.trim());
                }
            }
            
            // Validation
            if (items.length < 2) {
                return {
                    valid: false,
                    message: 'Please enter at least 2 alternatives'
                };
            }
            
            if (criteria.length < 2) {
                return {
                    valid: false,
                    message: 'Please enter at least 2 criteria'
                };
            }
            
            // Collect pairwise comparison matrices (simplified for now)
            const criteriaRank = [];
            const criteriaItemRank = [];
            
            // For now, use placeholder matrices
            // In a real implementation, you would collect these from the tables
            
            return {
                valid: true,
                items: items,
                criteria: criteria,
                criteriaRank: criteriaRank,
                criteriaItemRank: criteriaItemRank
            };
        }
        
        function executeOriginalCalculation(formData) {
            try {
                // Check if original function exists
                if (typeof window.runCalculation !== 'function') {
                    console.warn('runCalculation function not found');
                    return null;
                }
                
                // Update table headers with criteria names
                updateTableHeaders(formData.criteria);
                
                // Call original calculation
                const results = window.runCalculation(
                    formData.items,
                    formData.criteria,
                    formData.criteriaItemRank,
                    formData.criteriaRank
                );
                
                console.log('Original calculation results:', results);
                
                // Ensure charts are displayed
                setTimeout(ensureChartsVisible, 100);
                
                return results;
                
            } catch (error) {
                console.error('Error in original calculation:', error);
                return null;
            }
        }
        
        function performManualCalculation(formData) {
            // Simple manual calculation as fallback
            const itemCount = formData.items.length;
            const criteriaCount = formData.criteria.length;
            
            // Generate random weights for demonstration
            const criteriaWeights = Array(criteriaCount).fill(0)
                .map(() => Math.random())
                .map((val, i, arr) => val / arr.reduce((a, b) => a + b, 0));
            
            const alternativeScores = Array(itemCount).fill(0)
                .map(() => Math.random())
                .map((val, i, arr) => val / arr.reduce((a, b) => a + b, 0));
            
            return {
                criteria: {
                    labels: formData.criteria.map((c, i) => `${c}: ${criteriaWeights[i].toFixed(3)}`),
                    series: [criteriaWeights]
                },
                rankings: {
                    labels: formData.items.map((a, i) => `${a}: ${alternativeScores[i].toFixed(3)}`),
                    series: [alternativeScores]
                }
            };
        }
        
        function displayEnhancedResults(results) {
            console.log('Displaying enhanced results:', results);
            
            // Update status
            const resultsStatus = document.getElementById('results-status');
            const resultsStatusText = document.getElementById('results-status-text');
            
            if (resultsStatus && resultsStatusText) {
                resultsStatus.className = 'calculation-notice success';
                resultsStatusText.innerHTML = `
                    <strong>âœ“ Enhanced Analysis Complete</strong><br>
                    ${results.data?.criteria?.detailed?.length || 0} criteria analyzed<br>
                    ${results.data?.rankings?.detailed?.length || 0} alternatives ranked<br>
                    ${results.consistency?.isAcceptable ? 'Consistency: âœ“ Acceptable' : 'Consistency: âš ï¸ Review needed'}
                `;
            }
            
            // The enhanced-integration.js will handle detailed display
        }
        
        function displayManualResults(results) {
            // For manual results, we need to create the charts manually
            
            // Update the chart containers if they exist
            const criteriaChart = document.getElementById('criteria');
            const rankingsChart = document.getElementById('rankings');
            
            if (criteriaChart && window.chartist) {
                // Clear existing content
                criteriaChart.innerHTML = '';
                
                // Create simple bar chart for criteria
                const criteriaData = {
                    labels: results.criteria.labels,
                    series: results.criteria.series
                };
                
                const options = {
                    distributeSeries: true
                };
                
                new window.chartist.Bar(criteriaChart, criteriaData, options);
            }
            
            if (rankingsChart && window.chartist) {
                // Clear existing content
                rankingsChart.innerHTML = '';
                
                // Create simple bar chart for alternatives
                const rankingsData = {
                    labels: results.rankings.labels,
                    series: results.rankings.series
                };
                
                const options = {
                    distributeSeries: true
                };
                
                new window.chartist.Bar(rankingsChart, rankingsData, options);
            }
            
            // Show results section
            ensureResultsDisplay();
        }
        
        function updateTableHeaders(criteriaNames) {
            // Update criteria table headers
            criteriaNames.forEach((name, index) => {
                const header = document.querySelector(`.criteria${index}`);
                if (header) {
                    header.textContent = name || `Criterion ${index + 1}`;
                }
                
                const rowHeader = document.querySelector(`th.criteria${index}`);
                if (rowHeader) {
                    rowHeader.textContent = name || `Criterion ${index + 1}`;
                }
            });
            
            // Update criteria sentence
            const sentenceElement = document.getElementById('pairwise_criteria_sentence');
            if (sentenceElement && criteriaNames.length > 0) {
                sentenceElement.textContent = `Comparing: ${criteriaNames.join(', ')}`;
            }
        }
        
        function ensureChartsVisible() {
            // Check if charts are visible and initialize them if needed
            const criteriaChart = document.getElementById('criteria');
            const rankingsChart = document.getElementById('rankings');
            
            if (criteriaChart && !criteriaChart.innerHTML.trim()) {
                console.log('Initializing criteria chart container');
                criteriaChart.innerHTML = '<div class="chart-placeholder">Chart will appear here after calculation</div>';
            }
            
            if (rankingsChart && !rankingsChart.innerHTML.trim()) {
                console.log('Initializing rankings chart container');
                rankingsChart.innerHTML = '<div class="chart-placeholder">Chart will appear here after calculation</div>';
            }
        }
        
        function ensureResultsDisplay() {
            const resultsSection = document.getElementById('results');
            if (resultsSection) {
                resultsSection.style.display = 'block';
                resultsSection.classList.remove('results-hidden');
            }
            
            // Ensure charts are visible
            ensureChartsVisible();
        }
        
        function showCalculationSuccess(message) {
            const calcStatus = document.getElementById('calc-status');
            const calcStatusText = document.getElementById('calc-status-text');
            const resultsStatus = document.getElementById('results-status');
            const resultsStatusText = document.getElementById('results-status-text');
            
            if (calcStatus && calcStatusText) {
                calcStatus.className = 'calculation-notice success';
                calcStatusText.textContent = 'âœ“ ' + message;
            }
            
            if (resultsStatus && resultsStatusText) {
                resultsStatus.className = 'calculation-notice success';
                resultsStatusText.textContent = 'âœ“ Results calculated successfully!';
            }
        }
        
        function monitorSystemInitialization() {
            const statusElement = document.getElementById('system-status');
            let checkCount = 0;
            const maxChecks = 10;
            
            const checkSystem = setInterval(() => {
                checkCount++;
                
                if (window.SFactsApp) {
                    statusElement.textContent = 'Enhanced features: Ready âœ“';
                    statusElement.className = 'system-status active';
                    clearInterval(checkSystem);
                    console.log('SFactsApp detected after', checkCount, 'checks');
                } 
                else if (window.runCalculation) {
                    statusElement.textContent = 'Basic AHP system: Ready âœ“';
                    statusElement.className = 'system-status active';
                    clearInterval(checkSystem);
                    console.log('Basic AHP system detected after', checkCount, 'checks');
                }
                else if (checkCount >= maxChecks) {
                    statusElement.textContent = 'Using fallback calculation mode';
                    statusElement.className = 'system-status';
                    clearInterval(checkSystem);
                    console.log('Fallback mode activated');
                }
                else {
                    statusElement.textContent = `Loading systems... (${checkCount}/${maxChecks})`;
                    statusElement.className = 'system-status loading';
                }
            }, 1000);
        }
        
        function addCustomStyles() {
            const style = document.createElement('style');
            style.textContent = `
                .input-grid {
                    display: grid;
                    grid-template-columns: repeat(2, 1fr);
                    gap: 10px;
                    margin-bottom: 15px;
                }
                
                .input-grid input {
                    width: 100%;
                    padding: 8px;
                    border: 1px solid #ddd;
                    border-radius: 4px;
                    transition: border-color 0.3s ease;
                }
                
                .input-grid input:focus {
                    border-color: #667eea;
                    outline: none;
                    box-shadow: 0 0 0 2px rgba(102, 126, 234, 0.1);
                }
                
                .calculation-buttons {
                    margin: 20px 0;
                    padding: 20px 0;
                    border-top: 1px solid #eee;
                    text-align: center;
                }
                
                .btn-primary {
                    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                    color: white;
                    border: none;
                    padding: 12px 30px;
                    border-radius: 25px;
                    font-size: 16px;
                    font-weight: bold;
                    cursor: pointer;
                    transition: all 0.3s ease;
                    box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
                }
                
                .btn-primary:hover {
                    transform: translateY(-2px);
                    box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
                }
                
                .btn-primary:disabled {
                    opacity: 0.6;
                    cursor: not-allowed;
                    transform: none;
                }
                
                .chart-placeholder {
                    padding: 40px;
                    text-align: center;
                    color: #666;
                    background: #f8f9fa;
                    border-radius: 5px;
                    border: 2px dashed #dee2e6;
                }
                
                @media (max-width: 768px) {
                    .input-grid {
                        grid-template-columns: 1fr;
                    }
                    
                    .btn-primary {
                        width: 100%;
                        padding: 15px;
                    }
                }
            `;
            document.head.appendChild(style);
        }
        
        // Auto-restore form data on page load
        window.addEventListener('load', function() {
            setTimeout(() => {
                const restored = restoreFormData();
                if (restored) {
                    console.log('Form data auto-restored on page load');
                }
            }, 1000);
        });
        
        // Auto-save form data periodically
        setInterval(() => {
            storeFormData('periodic_autosave');
        }, 30000); // Every 30 seconds
    </script>
</body>
</html>
